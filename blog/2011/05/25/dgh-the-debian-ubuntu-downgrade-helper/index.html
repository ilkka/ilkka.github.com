<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1' name='viewport'>
<title>
ilkka.github.io
 - Dgh, The Debian/Ubuntu Downgrade Helper
</title>
<link href='/bootstrap/css/bootstrap.min.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/bootstrap/css/bootstrap-theme.min.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/css/pygments/default.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/css/style.css' media='screen' rel='stylesheet' type='text/css'>
<link href='http://feeds.feedburner.com/ilkkagithubcom' rel='alternate' type='application/atom+xml'>
<meta content='nanoc 3' name='generator'>
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3223507-4']);
    _gaq.push(['_trackPageview']);
    
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
  //]]>
</script>
</head>
<body>
<div class='container'>
<header class='row'>
<div class='col-sm-6'>
<a class='top-left-15px' href='/' id='sitetitle'>
ilkka.github.io
</a>
<h1 class='bold main-heading'>
Dgh, The Debian/Ubuntu Downgrade Helper
</h1>
</div>
<div class='col-sm-6'>
<div class='pull-right pad'>
<a href='http://feeds.feedburner.com/ilkkagithubcom'>
<img alt='Atom feed' src='/images/feed-icon-28x28.png'>
</a>

</div>
<div class='pull-right pad' id='search-container'>
<form action='#' id='sitesearch' method='GET'>
<button aria-hidden='true' class='close hidden' style='float: none' type='button'>
&times;
</button>
<input id='search-query' onkeypress='return !(window.event &amp;&amp; window.event.keyCode == 13)' placeholder='Search' type='text'>
</form>
</div>
</div>
</header>
<div class='row'>
<div class='col-sm-8 hidden' id='search-results'>
<h2>
Search results
<img class='spinner hidden' src='/images/ajax-loader.gif'>
</h2>
<div class='resultlist'></div>
</div>
<div class='col-sm-8' id='main-content'>
<article class='post'>
<div class='postmeta light text-muted'>
Posted on Wednesday 25 May 2011 and tagged <a href="/tag/ubuntu/">ubuntu</a> and <a href="/tag/sysadmin/">sysadmin</a>.

<div class='navlinks'>
Previously:&nbsp;<a href="/blog/2011/03/04/qtquick_2_scenegraph_glsl_fragment_shader_tutorial/">Qt Quick 2 QML Scene Graph GLSL fragment shader tutorial</a>
Next:&nbsp;<a href="/blog/2011/10/19/packaging_a_qt_app_for_os_x/">Packaging a Qt app for OS X</a>

</div>
</div>
<div class='postbody'>
<p>Ever had the bright idea of upgrading, say, your Ubuntu machine to use some
snazzy new software from a PPA, only to have it blow up in your face? The grim
realization that there’s no easy downgrade path, instead you’ll have to find
every single package the PPA upgraded and downgrade them by hand to keep
software from breaking? Me too!</p>

<p>I recently had this exact situation with the <a href="https://launchpad.net/~gnome3-team/+archive/gnome3">gnome3-team
PPA</a>. It worked like a
charm in my work computer, but when I tried it on my Nokia Booklet, it totally
failed, probably thanks to the infamous GMA500 graphics hardware. Anyway,
after a bit of hand-wringing I realized that:</p>

<ol>
  <li>I had to downgrade, there was stuff on the machine I didn’t want to wipe,</li>
  <li>I had been in this same situation before, and</li>
  <li>probably others had, too.</li>
</ol>

<p>So I wrote a little tool to help, and I’m glad to say it worked perfectly. The
tool is <a href="http://github.com/ilkka/dgh">dgh</a>, and it helps by finding the
packages that look like they need to be downgraded. It does this by looking at
<code>apt-cache policy</code> output, and finding packages whose installed version is not
available in any repository. Usage is simple, but requires some manual work
(for now):</p>

<ol>
  <li>Remove the offending package archive from apt’s sources</li>
  <li>Run <code>apt-get update</code>
</li>
  <li>Produce <code>apt-cache policy</code> output for all installed packages, e.g.:</li>
</ol>

<pre><code>    &lt;pre&gt;&lt;code&gt;dpkg --get-selections| \
egrep '\binstall'|awk '{print $1}'| \
xargs env LANG=C apt-cache policy| \
tee packages.list&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<ol>
  <li>Run <code>dgh</code> on the output:</li>
</ol>

<pre><code>    &lt;pre&gt;&lt;code&gt;$ dgh packages.list&lt;/code&gt;&lt;/pre&gt;
</code></pre>

<p>Dgh will report packages it thinks are downgrade candidates. Note that it will
probably report all manually installed packages too, so be careful when
downgrading.</p>

<p>I have a few enhancements I want to do before I call it 1.0, like not
requiring a pre-created policy output file and perhaps even performing the
downgrade by itself, but it’s usable now, just <a href="http://github.com/ilkka/dgh">grab the
code</a> or <code>gem install dgh</code> directly from
rubygems.</p>

</div>
</article>
<br style='break: both'>
<div class='related'>
<h3>More stuff like this</h3>
<ul>
<li>
<a href="/blog/2010/11/20/hosting-a-jekyll-blog-with-extensions-on-github/">Hosting a Jekyll blog with extensions on Github</a>
(2010-11-20)
</li>
<li>
<a href="/blog/2011/02/27/migrating_a_live_ubuntu_install_onto_lvm2/">Migrating a live Ubuntu install onto LVM2</a>
(2011-02-27)
</li>
<li>
<a href="/blog/2011/03/04/qtquick_2_scenegraph_glsl_fragment_shader_tutorial/">Qt Quick 2 QML Scene Graph GLSL fragment shader tutorial</a>
(2011-03-04)
</li>
</ul>

</div>
<div class='comments'>
<h3>Comments</h3>
<!-- begin disqus comment code -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
  * var disqus_identifier; [Optional but recommended: Define a
  unique identifier (e.g. post id or slug) for this thread] 
  */
  (function() {
  var dsq = document.createElement('script'); dsq.type =
  'text/javascript'; dsq.async = true;
  dsq.src = 'http://ilkkablog.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] ||
  document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view
  the <a href="http://disqus.com/?ref_noscript=ilkkablog">comments
    powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered
  by <span class="logo-disqus">Disqus</span></a>
<!-- end disqus comment code -->

<!-- begin disqus comment count code -->
<script type="text/javascript">
  var disqus_shortname = 'ilkkablog';
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/ilkkablog/count.js';
  (document.getElementsByTagName('HEAD')[0] ||
  document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
<!-- end disqus comment count code -->

</div>
</div>
<aside class='col-sm-3'>
<nav>
<h3>Find me elsewhere</h3>
<ul style='list-style-type: none'>
<li>
<a href='http://twitter.com/ilkkalaukkanen'>
<img alt='twitter.com/ilkkalaukkanen' src='/images/follow_bird_me-a.png'>
</a>
</li>
<li>
<a href='https://plus.google.com/111305386307650364124?rel=author'>Google</a>
</li>
<li>
<a href='https://github.com/ilkka'>github.com/ilkka</a>
</li>
<li>
<a href='https://bitbucket.org/Ilkka'>bitbucket.org/Ilkka</a>
</li>
</ul>

<h3>What else is here?</h3>
<ul>
<li>
<a href='/'>Front page</a>
</li>
<li>
Archives
<ul>
<li><a href="/archives/2010/11/">2010/11</a></li>
<li><a href="/archives/2010/12/">2010/12</a></li>
<li><a href="/archives/2011/01/">2011/1</a></li>
<li><a href="/archives/2011/02/">2011/2</a></li>
<li><a href="/archives/2011/03/">2011/3</a></li>
<li><a href="/archives/2011/05/">2011/5</a></li>
<li><a href="/archives/2011/10/">2011/10</a></li>
</ul>
</li>
</ul>

<h3>Tags</h3>
<ul class='tagcloud'>
<li style='font-size: 70.98373692144486%'>
<a href="/tag/meta/">meta</a>
</li>
<li style='font-size: 149.69506197546147%'>
<a href="/tag/ruby/">ruby</a>
</li>
<li style='font-size: 70.98373692144486%'>
<a href="/tag/jekyll/">jekyll</a>
</li>
<li style='font-size: 193.80930871145782%'>
<a href="/tag/coding/">coding</a>
</li>
<li style='font-size: 63.65616841209596%'>
<a href="/tag/qt/">qt</a>
</li>
<li style='font-size: 63.65616841209596%'>
<a href="/tag/qml/">qml</a>
</li>
<li style='font-size: 87.01563350411524%'>
<a href="/tag/ubuntu/">ubuntu</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/rake/">rake</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/photography/">photography</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/tools/">tools</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/vim/">vim</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/jitsu/">jitsu</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/ninja/">ninja</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/maemo/">maemo</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/n900/">n900</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/qtquick/">qtquick</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/glsl/">glsl</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/scenegraph/">scenegraph</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/opengl/">opengl</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/sysadmin/">sysadmin</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/osx/">osx</a>
</li>
</ul>

</nav>
</aside>
</div>
</div>
<footer class='bg-info'>
<div class='light text-muted'>
<p>This site was generated by <a href='http://nanoc.ws/'>Nanoc</a> and has <a href='http://getbootstrap.com'>Bootstrap</a>. Search courtesy of <a href='http://tapirgo.com/'>Tapir</a>.</p>
</div>
</footer>
<script src='/js/jquery-1.11.0.min.js' type='text/javascript'></script>
<script src='/bootstrap/js/bootstrap.min.js' type='text/javascript'></script>
<script src='/js/jquery-tapir.min.js' type='text/javascript'></script>
<script src='/js/jquery.history.js' type='text/javascript'></script>
<script src='/js/search.js' type='text/javascript'></script>
</body>
</html>
