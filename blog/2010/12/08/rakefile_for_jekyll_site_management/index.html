<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>
ilkka.github.com
 - Rakefile for Jekyll site management
</title>
<link href='http://fonts.googleapis.com/css?family=Cantarell:regular,italic,bold,bolditalic&amp;subset=latin' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Vollkorn:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<link href='/css/default.css' media='screen' rel='stylesheet' type='text/css'>
<link href='/css/pygments/default.css' media='screen' rel='stylesheet' type='text/css'>
<link href='http://feeds.feedburner.com/ilkkagithubcom' rel='alternate' type='application/atom+xml'>
<meta content='nanoc 3' name='generator'>
<script>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3223507-4']);
    _gaq.push(['_trackPageview']);
    
    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();
  //]]>
</script>
</head>
<body>
<div id='main-container'>
<div class='feed-icon-floater'>
<a href='http://ilkka.github.com/atom.xml'>
<img alt='Atom feed' src='/images/feed-icon-28x28.png'>
</a>

</div>
<div class='centered-container'>
<div id='header'>
<h1>
Rakefile for Jekyll site management
</h1>
</div>
<div id='content'>
<div class='post'>
<div class='postbody'>
<p>Previously I’ve used a bunch of scripts for managing post creation and site
compilation tasks, but recently I decided to move over to Rake. The whole
Rakefile as-it-stands is <a href="https://github.com/ilkka/ilkka.github.com/tree/source">in the
repo</a>, naturally, but
here’s a couple of bits I’m finding useful.</p>

<p>I have a <code>default</code> task set up that runs compass, jekyll, and <code>git commit</code>s
and <code>git push</code>es the result. The compass and jekyll bits are simple <code>sh</code>
steps, but the rest is a bit more involved. Let’s start with post creation
though, in the spirit of the real workflow.</p>

<pre><code class="language-ruby">namespace <span class="string"><span class="delimiter">"</span><span class="content">post</span><span class="delimiter">"</span></span> <span class="keyword">do</span>
  desc <span class="string"><span class="delimiter">"</span><span class="content">Given a title as an argument, create a new post file</span><span class="delimiter">"</span></span>
  task <span class="symbol">:new</span>, [<span class="symbol">:title</span>] <span class="keyword">do</span> |t, args|
    now = <span class="constant">DateTime</span>::now().to_date()
    filename = <span class="string"><span class="delimiter">"</span><span class="inline"><span class="inline-delimiter">#{</span>now.strftime<span class="inline-delimiter">}</span></span><span class="content">-</span><span class="inline"><span class="inline-delimiter">#{</span>args.title.gsub(<span class="regexp"><span class="delimiter">/</span><span class="char">\s</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">_</span><span class="delimiter">'</span></span>).downcase<span class="inline-delimiter">}</span></span><span class="content">.markdown</span><span class="delimiter">"</span></span>
    path = <span class="constant">File</span>.join(<span class="string"><span class="delimiter">"</span><span class="content">_posts</span><span class="delimiter">"</span></span>, filename)
    <span class="keyword">if</span> <span class="constant">File</span>.exist? path; raise <span class="constant">RuntimeError</span>.new(<span class="string"><span class="delimiter">"</span><span class="content">Won't clobber </span><span class="inline"><span class="inline-delimiter">#{</span>path<span class="inline-delimiter">}</span></span><span class="delimiter">"</span></span>); <span class="keyword">end</span>
    <span class="constant">File</span>.open(path, <span class="string"><span class="delimiter">'</span><span class="content">w</span><span class="delimiter">'</span></span>) <span class="keyword">do</span> |file|
      file.write <span class="string"><span class="delimiter">&lt;&lt;-EOS</span></span><span class="string"><span class="content">
---
layout: post
title: </span><span class="inline"><span class="inline-delimiter">#{</span>args.title<span class="inline-delimiter">}</span></span><span class="content">
---
Content goes here</span><span class="delimiter">
EOS</span></span>
    <span class="keyword">end</span>
    puts <span class="string"><span class="delimiter">"</span><span class="content">Now open </span><span class="inline"><span class="inline-delimiter">#{</span>path<span class="inline-delimiter">}</span></span><span class="content"> in an editor.</span><span class="delimiter">"</span></span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre>

<p>The above listing is the new post creation task, and the entirety of the
<code>post</code> namespace currently, as it happens. It takes the post title as an
argument, and uses that and the current date to generate a filename. At the
moment it just replaces whitespace with underscores, but it might be good to
do more escaping to ensure a good filename. Then the task writes a post
template into the file and prints the filename so it’s easy to launch an
editor for it.</p>

<p>To ensure good clean commits of the site I clean the <code>_site</code> directory before
compilation, i.e. delete all files except for any dotfiles, so as not to
destroy the <code>.git</code> dir in there. I use a helper method to get a list of all
the files:</p>

<pre><code class="language-ruby"><span class="keyword">def</span> <span class="function">site_files</span>
  <span class="constant">FileList</span>[<span class="string"><span class="delimiter">'</span><span class="content">_site/**/*</span><span class="delimiter">'</span></span>].find_all {|f| <span class="constant">File</span>.file? f}
<span class="keyword">end</span></code></pre>

<p>This file list is then used in the <code>clean</code> and <code>commit</code> tasks like this:</p>

<pre><code class="language-ruby">desc <span class="string"><span class="delimiter">"</span><span class="content">Clean generated site files</span><span class="delimiter">"</span></span>
task <span class="symbol">:clean</span> <span class="keyword">do</span>
  <span class="constant">FileUtils</span>.rm site_files
<span class="keyword">end</span>

desc <span class="string"><span class="delimiter">"</span><span class="content">Commit compiled site to Git</span><span class="delimiter">"</span></span>
task <span class="symbol">:commit</span> <span class="keyword">do</span>
  g = <span class="constant">Git</span>.open(<span class="string"><span class="delimiter">'</span><span class="content">_site</span><span class="delimiter">'</span></span>)
  g.add site_files.map {|f| f.gsub(<span class="regexp"><span class="delimiter">/</span><span class="content">^_site</span><span class="char">\/</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)}
  g.commit <span class="string"><span class="delimiter">"</span><span class="content">Regenerated</span><span class="delimiter">"</span></span>
<span class="keyword">end</span>

desc <span class="string"><span class="delimiter">"</span><span class="content">Push committed site to GitHub</span><span class="delimiter">"</span></span>
task <span class="symbol">:push</span> <span class="keyword">do</span>
  g = <span class="constant">Git</span>.open(<span class="string"><span class="delimiter">'</span><span class="content">_site</span><span class="delimiter">'</span></span>)
  g.push
<span class="keyword">end</span></code></pre>

<p>The <code>clean</code> task is simple because one can use the filelist directly, but when
committing, the <code>_site</code> dir bit has to be dropped from the filenames with a
simple <code>map</code> + <code>gsub</code> combo. I’m using <a href="https://github.com/schacon">Scott
Chacon’s</a> <a href="https://github.com/schacon/ruby-git">ruby-git
gem</a> to perform git operations on the
repo.</p>

<p>That’s pretty much it for the moment. I might expand the post management
features a bit at some point though, but since most of that is no simpler via
Rake than through shell commands and an editor, it remains to be seen what
those new features might be.</p>
</div>
<div class='postfooter'>
Posted on Wednesday  8 December 2010 and tagged <a href="/tag/meta/">meta</a>, <a href="/tag/ruby/">ruby</a>, <a href="/tag/rake/">rake</a>, <a href="/tag/jekyll/">jekyll</a> and <a href="/tag/coding/">coding</a>.

</div>
</div>
<div class='navlinks'>
<div class='previous' style='float: left'>
Previously:&nbsp;<a href="/blog/2010/11/29/where-to-find-packages-for-my-software/">Where to find packages for my software</a>
</div>
<div class='next' style='float: right'>
Next:&nbsp;<a href="/blog/2010/12/08/shooting_tethered_with_the_nikon_d80_and_ubuntu/">Shooting tethered with the Nikon D80 and Ubuntu</a>
</div>

</div>
<br style='break: both'>
<div class='related'>
<h3>More stuff like this</h3>
<ul>
<li>
<a href="/blog/2010/11/20/hosting-a-jekyll-blog-with-extensions-on-github/">Hosting a Jekyll blog with extensions on Github</a>
(2010-11-20)
</li>
<li>
<a href="/blog/2011/03/04/qtquick_2_scenegraph_glsl_fragment_shader_tutorial/">Qt Quick 2 QML Scene Graph GLSL fragment shader tutorial</a>
(2011-03-04)
</li>
<li>
<a href="/blog/2011/10/19/packaging_a_qt_app_for_os_x/">Packaging a Qt app for OS X</a>
(2011-10-19)
</li>
</ul>

</div>
<div class='comments'>
<h3>Comments</h3>
<!-- begin disqus comment code -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /**
  * var disqus_identifier; [Optional but recommended: Define a
  unique identifier (e.g. post id or slug) for this thread] 
  */
  (function() {
  var dsq = document.createElement('script'); dsq.type =
  'text/javascript'; dsq.async = true;
  dsq.src = 'http://ilkkablog.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] ||
  document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view
  the <a href="http://disqus.com/?ref_noscript=ilkkablog">comments
    powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered
  by <span class="logo-disqus">Disqus</span></a>
<!-- end disqus comment code -->

<!-- begin disqus comment count code -->
<script type="text/javascript">
  var disqus_shortname = 'ilkkablog';
  (function () {
  var s = document.createElement('script'); s.async = true;
  s.src = 'http://disqus.com/forums/ilkkablog/count.js';
  (document.getElementsByTagName('HEAD')[0] ||
  document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
<!-- end disqus comment count code -->

</div>
</div>
</div>
</div>
<div id='footer-container'>
<div id='footer'>
<div class='col'>
<h3>What else is here?</h3>
<ul>
<li>
<a href='/'>Front page</a>
</li>
<li>
Archives
<ul>
<li><a href="/archives/2010/11/">2010/11</a></li>
<li><a href="/archives/2010/12/">2010/12</a></li>
<li><a href="/archives/2011/01/">2011/1</a></li>
<li><a href="/archives/2011/02/">2011/2</a></li>
<li><a href="/archives/2011/03/">2011/3</a></li>
<li><a href="/archives/2011/05/">2011/5</a></li>
<li><a href="/archives/2011/10/">2011/10</a></li>
</ul>
</li>
</ul>

</div>
<div class='col'>
<h3>Tags</h3>
<ul class='tagcloud'>
<li style='font-size: 70.98373692144486%'>
<a href="/tag/meta/">meta</a>
</li>
<li style='font-size: 149.69506197546147%'>
<a href="/tag/ruby/">ruby</a>
</li>
<li style='font-size: 70.98373692144486%'>
<a href="/tag/jekyll/">jekyll</a>
</li>
<li style='font-size: 193.80930871145782%'>
<a href="/tag/coding/">coding</a>
</li>
<li style='font-size: 63.65616841209596%'>
<a href="/tag/qt/">qt</a>
</li>
<li style='font-size: 63.65616841209596%'>
<a href="/tag/qml/">qml</a>
</li>
<li style='font-size: 87.01563350411524%'>
<a href="/tag/ubuntu/">ubuntu</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/rake/">rake</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/photography/">photography</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/tools/">tools</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/vim/">vim</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/jitsu/">jitsu</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/ninja/">ninja</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/maemo/">maemo</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/n900/">n900</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/qtquick/">qtquick</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/glsl/">glsl</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/scenegraph/">scenegraph</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/opengl/">opengl</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/sysadmin/">sysadmin</a>
</li>
<li style='font-size: 60.99642213298283%'>
<a href="/tag/osx/">osx</a>
</li>
</ul>

</div>
<div class='col'>
<h3>Find me elsewhere</h3>
<ul style='list-style-type: none'>
<li>
<a href='http://twitter.com/ilkkalaukkanen'>
<img alt='twitter.com/ilkkalaukkanen' src='/images/follow_bird_me-a.png'>
</a>
</li>
<li>
<a href='http://goo.gl/LSptt'>google plus</a>
</li>
<li>
<a href='https://github.com/ilkka'>github.com/ilkka</a>
</li>
<li>
<a href='https://bitbucket.org/Ilkka'>bitbucket.org/Ilkka</a>
</li>
</ul>

</div>
<div id='credits'>
<p>This site was generated by <a href='http://nanoc.stoneship.org'>Nanoc</a>. Fonts courtesy of <a href='http://code.google.com/webfonts'>Google Font Directory</a>.</p>
</div>
</div>
</div>
</body>
</html>
